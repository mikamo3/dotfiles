#!/usr/bin/env bash
set -e

if [[ $# == 0 ]]; then
  echo "usage: $(basename "$0") repositoryname"
  exit 1
fi
repositoryname="$1"

if ! type ghq &>/dev/null 2>&1; then
  echo "need ghq"
  exit 1
fi

if ! type hub &>/dev/null 2>&1; then
  echo "need hub"
  exit 1
fi
tempdir="$(mktemp -d)/$repositoryname"
mkdir -p "$tempdir"
cd "$tempdir"

git init
hub create

repourl="$(git remote get-url origin)"

# ssh only
repopath="${repourl#*:}"
repopath="${repopath//.git/}"

ghq get -p "$repopath"
rm -rf "$tempdir"
